<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    padding: 100px;
    width: 1000px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h4 {
    font-family: 'Source Sans Pro', sans-serif;
  }
</style>
<title>CS 184 Mesh Editor</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
</head>


<body>

<h1 align="middle">CS 184: Computer Graphics and Imaging, Summer 2020</h1>
<h1 align="middle">Project 4: Cloth Simulator</h1>
<h2 align="middle">John Schulz, CS184-SU</h2>

<br><br>

<div>

<h2 align="middle">Overview</h2>
<p> This project was focused on generating graphics that mimic how cloth behaves in the real world. I implemented cloth’s behavior using springs and multiple ways to measure collisions and intersections with other objects. The result of this project was a graphical user interface that allowed the user to toggle between different shading techniques and apply different parameters to make the scene behave differently. Through this report, I will outline the techniques I implemented and show some of the fascinating results I generated. </p>
<h2 align="middle">Part I: Masses and springs</h2>
<p>Implementation: This portion of the project set up the framework to create a cloth with a wireframe structure to support the implementation of future parts. To do this, I first iterated through all coordinate locations, edited points accordingly to their orientation and initialized them by adding them to the point_masses with a pinned value of true for coordinates found in pinned vector and false for everything else. After initializing these point masses, I added structural, shearing and bending springs between for every point mass. Structural constraints were added between a point mass and the point mass to its left and above it. Shearing constraints were added diagonally between the upper left and upper right of a point mass. Lastly, bending constraints were added between a point mass two away to right and two above each point mass. Altogether, these steps lead to a wireframe that mimicked the behavior of a cloth.</p>


<p> Two viewing angles where you can clearly see the cloth wireframe and the structure of the point masses and springs.</p>

<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/1.png" align="middle" width="400px"/>
        <figcaption align="middle"></figcaption>
      </td>
      <td>
        <img src="images/2.png" align="middle" width="400px"/>
        <figcaption align="middle"></figcaption>
      </td>

    </tr>
  </table>
</div>

<p>Wireframe with (1) without any shearing constraints, (2) with only shearing constraints, and (3) with all constraints.</p>

<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/noShearing.png" align="middle" width="400px"/>
        <figcaption align="middle">(1) No Shearing</figcaption>
      </td>
      <td>
        <img src="images/onlyShearing.png" align="middle" width="400px"/>
        <figcaption align="middle">(2) Only Shearing</figcaption>
      </td>

    </tr>
    <tr>
      <td>
        <img src="images/allConstraints.png" align="middle" width="400px"/>
        <figcaption align="middle">(3) All Constraints</figcaption>
      </td>
    </tr>
  </table>
</div>

<h2 align="middle">Part 2: Simulation via Numerical Integration</h2>
<p>Implementation: For this part of the project, I extrapolated from the wireframe structure I set up in part to create simulations based on how cloth interacts with gravity. To start, I iterated through each and every point mass to calculate the total force acting on each point using Hooke’s law. For each spring, the structural constraints were checked to see how much to adjust each point connecting on the end of a spring. After these initial forces were calculated, I used Verlet Integration to see how each point mass’s position changed during this time step. For each point mass, I calculated their next position with energy loss (damping) considered if the point was not pinned. Ultimately, after generating new positions I ensured that each spring would not expand 10% greater than its rest length. If an edited spring’s length did expand past this threshold, I updated half of the correction to each point when both points weren’t pinned and the whole threshold to points that shared a spring with a pinned point mass. This initial implementation would be further expanded in future parts.</p>

<h4>Manipulating Parameters</h2>
<p>ks: Changing the spring constant, ks, changes how the stiff or elastic the spring is. Lower ks values lead to the cloth to sag and stretch more while higher ks values make the springs more stiff and lead to a stiffer cloth.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/lowK.png" align="middle" width="400px"/>
        <figcaption align="middle">Small Spring Constant</figcaption>
      </td>
      <td>
        <img src="images/highK.png" align="middle" width="400px"/>
        <figcaption align="middle">High Spring Constant</figcaption>
      </td>
    </tr>
  </table>
</div>

<p>Density: Changing the density behaves in a similar way to changing the spring constant value. High density leads to the cloth sagging more while a low density makes the cloth appear more stiff and less affected by gravity.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/lowD.png" align="middle" width="400px"/>
        <figcaption align="middle">Small Density</figcaption>
      </td>
      <td>
        <img src="images/highD.png" align="middle" width="400px"/>
        <figcaption align="middle">High Density</figcaption>
      </td>
    </tr>
  </table>
</div>

<p>Damping: Damping changes how the springs and ultimately the cloth react to a changing state. In the images below you can see how a high damping value leads to the cloth falling slower and a more uniform fashion. Comparitively, with a low damping value, the cloth falls very quickly and seems to bounce more freely after this initial fall.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/lowDa.png" align="middle" width="400px"/>
        <figcaption align="middle">Small Damping</figcaption>
      </td>
      <td>
        <img src="images/highDa.png" align="middle" width="400px"/>
        <figcaption align="middle">High Damping</figcaption>
      </td>
    </tr>
  </table>
</div>
<p> Below is an image of my cloth at its final resting state with Normal shading to show the tension on the wireframe. My colors came out different than the specs but it appears to have the same relative behavior for each section of the cloth.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/p2.png" align="middle" width="400px"/>
        <figcaption align="middle">Final Resting State</figcaption>
      </td>
    </tr>
  </table>
</div>


<h2 align="middle">Part 3: Handling Collisions with Other Objects</h2>
<p>Implementation: After implementing how point mass’s and the cloth, in general, changed when forces were applied to it, I started to consider how a cloth interacted with other surfaces such as spheres and planes. First, I handled collisions with spheres by using the relationship between the cloth’s trajectory and the tangent point where the cloth would meet the sphere. If the point mass’s next positions intersected or fell within the sphere, I updated its position by adding a scaled difference between the tangent point and the point mass’s last position. Following the handling of collisions with spheres, I implemented how points reacted to collisions with planes. If the point mass’s crossed through the plane (current position and last position on opposite sides), I found its tangent point by using the planes normal vector, calculated the correction vector (the difference between the tangent point and the last position), and updated the point mass’s position with this correction vector scaled and a surface offset to ensure the cloth layed above the plane. Lastly, I extended my previous simulation implementation to handle collisions by iterating through each point mass and running these unique collide methods on them for all the collisions that exist.</p>

<p>Below are images of a shaded cloth resting on a sphere with differing spring constat or ks values. As expected these images follow similar behaviors to the previus section where I displayed stiffer cloths with higher ks values and a more saggy cloth when ks values were smaller. When ks equals 50000 the cloth looks stiffer and fans out wider than when ks equals 500 and the cloth sags downward much more drastically. As I stated above, this occurs because the spring constant determines the springs elasticity and stiffness.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/5000.png" align="middle" width="400px"/>
        <figcaption align="middle">ks = 5000</figcaption>
      </td>
      <td>
        <img src="images/50000.png" align="middle" width="400px"/>
        <figcaption align="middle">ks = 50000</figcaption>
      </td>

    </tr>
    <tr>
      <td>
        <img src="images/500.png" align="middle" width="400px"/>
        <figcaption align="middle">ks = 500</figcaption>
      </td>
    </tr>
  </table>
</div>

<p>Shaded cloth lying peacefully at rest on a plane.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/plane.png" align="middle" width="400px"/>
        <figcaption align="middle">Cloth Flat on a Plane</figcaption>
      </td>
    </tr>
  </table>
</div>


<h2 align="middle">Part 4: Handling self-collisions</h2>
<p>Implementation: In the previous part, I implemented how a cloth interacted with other objects, but I did not account for how the cloth collides with itself. To do this in a timely fashion, I implemented spatial hashing by constructing a hash table that maps unique floats to a vector of point mass’s. Before constructing my hash table, I created a hash function to truncate each point to the closest coordinate within a 3D box by using floor division and scalars. After defining my hash function, I iterated through each point mass and initialized a new point mass vector if the spatial map did not already account for the point. Ultimately, I used this spatial map for checking collisions between every point and their respective potential candidates. If the difference between the point mass and the candidate position was less than the threshold of two times the thickness and they aren’t the same point mass object, I updated the point mass’s position by adding the average of all the correction vectors that were calculated using the difference of the current position and candidate’s positions. The final result of this implementation is a cloth that folds on itself in a natural way that follows the rules of physics in the natural world.</p>
<p>A cloth collapsing on itself as captured with images that show it at an early state, mid state, and nearly resting state.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/early.png" align="middle" width="400px"/>
        <figcaption align="middle">Early State</figcaption>
      </td>
      <td>
        <img src="images/mid.png" align="middle" width="400px"/>
        <figcaption align="middle">Middle State</figcaption>
      </td>

    </tr>
    <tr>
      <td>
        <img src="images/rest.png" align="middle" width="400px"/>
        <figcaption align="middle">Nearly Resting State</figcaption>
      </td>
    </tr>
  </table>
</div>


<p> Below are four images that show how changing the density changes the behavior of self collisions on a cloth falling on a plane. In the top two images there is a lower density and we see the cloth fold more smootly and with less bends. Comparitively, for the two bottom images with a much higher density the cloth folds in on itself more often and there are resultantly more ruffles as the cloth collapses.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/lowDearly.png" align="middle" width="400px"/>
        <figcaption align="middle">Low Density Early State</figcaption>
      </td>
      <td>
        <img src="images/lowDlate.png" align="middle" width="400px"/>
        <figcaption align="middle">Low Density Late State</figcaption>
      </td>

    </tr>
    <tr>
      <td>
        <img src="images/highDearly.png" align="middle" width="400px"/>
        <figcaption align="middle">High Density Early State</figcaption>
      </td>
      <td>
        <img src="images/highDlate.png" align="middle" width="400px"/>
        <figcaption align="middle">High Density Late State</figcaption>
      </td>
    </tr>
  </table>
</div>

<h2 align="middle">Part 5: Shaders</h2>
<p>Shader Programs (implementation): This portion of the project consisted of implementing a series of shader programs to add textures, colors, and lighting to the cloth graphics we previously generated. To do this, I used GLSL, a language similar to C, to add color and shader attributes to graphic positions within the scene. For each task in this part, I implemented fragment shaders to write colors onto positions by using the vertex values that were rasterized using a vertex shader file. Together these vertex shaders and fragment shaders allowed me to portray lighting and material effects such as diffuse shading, Phong shading, mirror shading, and texture mapping. </p>

<p>Blinn-Phong Shading Model: To implement Blinn-Phong shading, I extrapolated from the first task of this part that added diffuse lighting by using the diffuse coefficient, kd, and illumination from the source. For Blinn-Phong shading, I used diffuse lighting in addition to ambient shading and specular shading. Ambient shading added a constant color for all positions that were intersected with. Specular shading is modeled similarly to diffuse lighting but using a different coefficient and highlights generate by a vector off a surface. Together, these three shading types come together to create _hong shading that is depicted below.</p>
<p> Blinn-Phong shader outputting only the ambient component, only outputting the diffuse component, only outputting the specular component, and finally one using the entire Blinn-Phong model.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/ambient.png" align="middle" width="400px"/>
        <figcaption align="middle">Only Ambient Component</figcaption>
      </td>
      <td>
        <img src="images/diffuse.png" align="middle" width="400px"/>
        <figcaption align="middle">Only Diffuse Component</figcaption>
      </td>

    </tr>
    <tr>
      <td>
        <img src="images/specular.png" align="middle" width="400px"/>
        <figcaption align="middle">Only Specular Component</figcaption>
      </td>
      <td>
        <img src="images/all.png" align="middle" width="400px"/>
        <figcaption align="middle">Entire Blinn-Phong Model</figcaption>
      </td>
    </tr>
  </table>
</div>

<p>A texture mapping shader using my own custom texture.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/texture.png" align="middle" width="400px"/>
        <figcaption align="middle">Texture Mapping</figcaption>
      </td>
    </tr>
  </table>
</div>
<p>A mirror shader showing the cloth with a reflective behavior.</p>
<div align="middle">
  <table style="width=100%">
    <tr>
      <td>
        <img src="images/mirror.png" align="middle" width="400px"/>
        <figcaption align="middle">Mirro</figcaption>
      </td>
    </tr>
  </table>
</div>


</body>
</html>
